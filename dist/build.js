var tetris=function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){let r=i(1);e.tetris=r},function(t,e){let i={rotateLine:function(t,e){let r=[],n=[],o=[],s=-1,l=[];e.forEach(function(t){l.push(Object.assign({},t))}),e.forEach(function(t){r.push(Object.assign({},t))});for(let t of r)n.push(t.x),o.push(t.y);if(o[0]===o[1]&&o[2]===o[3]&&o[1]===o[2]){for(let t of r)t.x=n[1],t.y=o[0]+s,s++;return this.checkThatTheFieldIsFree(r,t)?r:l}if(n[0]===n[1]&&n[2]===n[3]&&n[1]===n[2]){let e=[];r.forEach(function(t){e.push(Object.assign({},t))});for(let t of e)t.y=o[1],t.x=n[0]+s,s++;return this.checkThatTheFieldIsFree(e,t)?e:l}if(n[0]<n[1]&&n[1]<n[2]&&n[2]===n[3]&&o[0]===o[1]&&o[1]>o[2]&&o[2]<o[3]){return function(e){let r=[];for(let t=0,i=0;t<e.length;t++,i++){let n={};0===i?(n.x=e[t].x,n.y=e[t].y-1):1===i?(n.x=e[t].x,n.y=e[t].y-1):2===i?(n.x=e[t].x-1,n.y=e[t].y+1):3===i&&(n.x=e[t].x-1,n.y=e[t].y+1),r.push(n)}return i.checkThatTheFieldIsFree(r,t)?r:l}(l)}if(n[0]<n[1]&&n[1]===n[2]&&n[2]===n[3]&&o[0]===o[1]&&o[1]<o[2]&&o[2]<o[3]){return function(e){let r=[];for(let t=0,i=0;t<e.length;t++,i++){let n={};0===i?(n.x=e[t].x,n.y=e[t].y):1===i?(n.x=e[t].x-1,n.y=e[t].y+1):2===i?(n.x=e[t].x,n.y=e[t].y-1):3===i&&(n.x=e[t].x+1,n.y=e[t].y-2),r.push(n)}return i.checkThatTheFieldIsFree(r,t)?r:l}(l)}if(n[0]===n[1]&&n[1]<n[2]&&n[2]<n[3]&&o[0]<o[1]&&o[1]>o[2]&&o[2]===o[3]){return function(e){let r=[];for(let t=0,i=0;t<e.length;t++,i++){let n={};0===i?(n.x=e[t].x,n.y=e[t].y):1===i?(n.x=e[t].x,n.y=e[t].y):2===i?(n.x=e[t].x-1,n.y=e[t].y+2):3===i&&(n.x=e[t].x-1,n.y=e[t].y+2),r.push(n)}return i.checkThatTheFieldIsFree(r,t)?r:l}(l)}if(n[0]===n[1]&&n[1]===n[2]&&n[2]<n[3]&&o[0]<o[1]&&o[1]<o[2]&&o[2]===o[3]){return function(e){let r=[];for(let t=0,i=0;t<e.length;t++,i++){let n={};0===i?(n.x=e[t].x,n.y=e[t].y+1):1===i?(n.x=e[t].x+1,n.y=e[t].y):2===i?(n.x=e[t].x+2,n.y=e[t].y-2):3===i&&(n.x=e[t].x+1,n.y=e[t].y-1),r.push(n)}return i.checkThatTheFieldIsFree(r,t)?r:l}(l)}},checkThatTheFieldIsFree:function(t,e){if(!this.allItemsOnTheField(t,e))return!1;for(let i of t)if(e[i.y][i.x])return!1;return!0},allItemsOnTheField:function(t,e){let i=e[0].length,r=e.length;for(let e of t)if(e.x<0||e.y<0||e.x>=i||e.y>=r)return!1;return!0},buildField:function(t){let e=t.split("\n");for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++)if("-"!==e[t][i]&&"X"!==e[t][i]&&0!=e[t][i])throw new Error("invalid symbol");let i=[];for(let t=0;t<e.length;t++){let r=[];for(let i=0;i<e[t].length;i++)"-"===e[t][i]?r.push(!1):"X"===e[t][i]&&r.push(!0);0!==r.length&&i.push(r)}if(0===i.length)throw new Error("field whitespace");return i},getCoordinates:function(t){let e=t.split("\n"),i=[];for(let t=0,r=0;t<e.length;t++)if(""!==e[t]){for(let n=0,o=0;n<e[t].length;n++){let s={};"-"===e[t][n]&&o++,"X"===e[t][n]&&(s.x=o,s.y=r,0,i.push(s),o++)}r++}return i.sort(this.orderCoordinates)},buildTetromino:function(t){let e=[];if(this.getCoordinates(t).forEach(function(t){e.push(Object.assign({},t))}),4!==e.length)throw new Error("tetromino size is not correct");return e},rotateElement:function(t,e){let i=e.y-t.y,r=e.x-t.x;return{x:e.x-i,y:e.y+r}},rotatesArrayOfCoordinates:function(t,e){let i=[];for(let r of t)i.push(this.rotateElement(r,e));return i.sort(this.orderCoordinates)},orderCoordinates:function(t,e){return t.x===e.x?t.y-e.y:t.x-e.x},calculatorCoordinateOfTopLeft:function(t){let e={};for(let i=0;i<t.length;i++)(e.x>t[i].x||void 0===e.x)&&(e.x=t[i].x),(e.y>t[i].y||void 0===e.y)&&(e.y=t[i].y);return e},shiftCoordinate:function(t,e){let i={};return i.x=t.x+e.x,i.y=t.y+e.y,i},shiftCoordinates:function(t,e){let i=[];for(let r of t)i.push(this.shiftCoordinate(r,e));return i},determineShift:function(t,e){if("O"===t&&"stable"===e)return{x:0,y:1};if("J"===t){if("up"===e)return{x:0,y:1};if("left"===e)return{x:0,y:2};if("down"===e)return{x:0,y:1};if("right"===e)return{x:0,y:2}}if("L"===t){if("up"===e)return{x:0,y:1};if("left"===e)return{x:0,y:2};if("down"===e)return{x:0,y:1};if("right"===e)return{x:0,y:2}}if("T"===t){if("up"===e)return{x:0,y:2};if("left"===e)return{x:0,y:2};if("down"===e)return{x:1,y:1};if("right"===e)return{x:-1,y:1}}if("S"===t){if("horizontal"===e)return{x:0,y:2};if("vertical"===e)return{x:0,y:1}}if("Z"===t){if("horizontal"===e)return{x:0,y:2};if("vertical"===e)return{x:0,y:1}}if("I"===t){if("horizontal"===e)return{x:1,y:2};if("vertical"===e)return{x:-1,y:1}}},rotateTetromino:function(t,e,i){let r=this.determineShift(t,e),n=this.calculatorCoordinateOfTopLeft(i),o=this.rotatesArrayOfCoordinates(i,n);return this.shiftCoordinates(o,r).sort(this.orderCoordinates)},incrementPhase:function(t,e){let i=[];"I"!==t&&"S"!==t&&"Z"!==t||(i=["vertical","horizontal"]),"L"!==t&&"J"!==t&&"T"!==t||(i=["up","left","down","right"]),"O"===t&&(i=["stable"]);let r=i.indexOf(e);return r!==i.length-1?i[r+1]:i[0]},Tetromino:class{constructor(t,e,i){this.typeOfTetromino=t,this.rotationPhase=e,this.coordinates=i}rotateTetromino(t){let e=i.rotateTetromino(this.typeOfTetromino,this.rotationPhase,this.coordinates);return i.checkThatTheFieldIsFree(e,t)?(this.rotationPhase=i.incrementPhase(this.typeOfTetromino,this.rotationPhase),this.coordinates=e,e):this.coordinates}moveTetromino(t,e){let r=i.shiftCoordinates(this.coordinates,e);return i.checkThatTheFieldIsFree(r,t)?(this.coordinates=r,r):this.coordinates}canMoveDown(t){let e=i.shiftCoordinates(this.coordinates,{x:0,y:1});return i.checkThatTheFieldIsFree(e,t)}},Field:class{constructor(t){if(Array.isArray(t))this.field=t;else{this.field=[];for(let e=0;e<t.y;e++){let e=[];for(let i=0;i<t.x;i++)e.push(!1);this.field.push(e)}}this.fieldSize={x:this.field[0].length,y:this.field.length}}addTetrominoToField(t){for(let e=0;e<t.length;e++)this.field[t[e].y][t[e].x]=!0;return this.field}cleanFilledRows(){for(let t=0;t<this.fieldSize.y;t++){let e=0;for(let i=0;i<this.fieldSize.x;i++)this.field[t][i]&&e++;if(this.fieldSize.x===e){let e=[];for(let t=0;t<this.fieldSize.x;t++)e.push(!1);this.field.splice(t,1),this.field.unshift(e)}}return this.field}},startingPhaseOfTetromino:function(t){switch(t){case"L":return"right";case"J":return"left";case"T":return"up";case"Z":case"S":case"I":return"horizontal";case"O":return"stable"}},getRandomTypeOfTetromino:function(){let t=["L","J","T","S","Z","I","O"];return t[Math.floor(Math.random()*t.length)]},initCoordinates:function(t,e){let i,r={x:Math.floor(e.x/2-1),y:0};switch(t){case"L":i=this.getCoordinates("\n\t\t\t\t\t--X\n\t\t\t\t\tXXX\n\t\t\t\t");break;case"J":i=this.getCoordinates("\n\t\t\t\t\tX--\n\t\t\t\t\tXXX\n\t\t\t\t");break;case"T":i=this.getCoordinates("\n\t\t\t\t\t-X-\n\t\t\t\t\tXXX\n\t\t\t\t");break;case"Z":i=this.getCoordinates("\n\t\t\t\t\tXX-\n\t\t\t\t\t-XX\n\t\t\t\t");break;case"S":i=this.getCoordinates("\n\t\t\t\t\t-XX\n\t\t\t\t\tXX\n\t\t\t\t");break;case"I":r.x=r.x-1,i=this.getCoordinates("\n\t\t\t\t\tXXXX\n\t\t\t\t");break;case"O":i=this.getCoordinates("\n\t\t\t\t\tXX\n\t\t\t\t\tXX\n\t\t\t\t")}return this.shiftCoordinates(i,r)},createTetromino:function(t){let e=this.getRandomTypeOfTetromino(),i=this.startingPhaseOfTetromino(e),r=this.initCoordinates(e,t);return new this.Tetromino(e,i,r)},Tetris:class{constructor(t,e){this.fieldSize=t,this.typeOfTetromino=i.getRandomTypeOfTetromino(),this.coordinatesOfTetramino=i.initCoordinates(this.typeOfTetromino,this.fieldSize),this.tetromino=i.createTetromino(this.fieldSize),this.field=new i.Field(this.fieldSize),this.gameOverCallback=e}tick(){let t={x:0,y:1};this.tetromino.canMoveDown(this.field.field)?this.tetromino.moveTetromino(this.field.field,t):(this.field.addTetrominoToField(this.tetromino.coordinates),this.tetromino=i.createTetromino(this.fieldSize),this.field.cleanFilledRows(),i.checkThatTheFieldIsFree(this.tetromino.coordinates,this.field.field)||this.gameOverCallback())}moveLeft(){this.tetromino.moveTetromino(this.field.field,{x:-1,y:0})}moveRight(){this.tetromino.moveTetromino(this.field.field,{x:1,y:0})}moveDown(){this.tetromino.moveTetromino(this.field.field,{x:0,y:1})}rotate(){this.tetromino.rotateTetromino(this.field.field)}},displayField:function(t,e,i){let r="\n            ";for(let n=0;n<t.y;n++){n>0&&(r+="\n            ");for(let o=0;o<t.x;o++)i[n][o]?r+="o":this.coordinateMatchingCheck(e,o,n)?r+="X":r+="-"}return r+="\n        "},coordinateMatchingCheck:function(t,e,i){for(let r=0;r<t.length;r++)if(t[r].x===e&&t[r].y===i)return!0;return!1}};t.exports=i}]);